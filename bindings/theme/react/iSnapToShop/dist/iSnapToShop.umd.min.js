!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("React"),require("sharedUtilsLibrary")):"function"==typeof define&&define.amd?define("extension",["React","sharedUtilsLibrary"],t):"object"==typeof exports?exports.extension=t(require("React"),require("sharedUtilsLibrary")):e.extension=t(e.React,e.sharedUtilsLibrary)}("undefined"!=typeof self?self:this,((e,t)=>(()=>{"use strict";var a={173:e=>{e.exports=t},883:t=>{t.exports=e}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={exports:{}};return a[e](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};n.r(i),n.d(i,{default:()=>m});var o={};n.r(o),n.d(o,{Component:()=>c,settings:()=>g});var l=n(883),d=n.n(l),p=n(173);const s={container:{margin:"0 auto",fontFamily:'"Inter", "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',background:"linear-gradient(135deg,#0C5273 0%,#0C5272 100%)",minHeight:"0vh",position:"relative",overflow:"hidden"},title:{textAlign:"center",color:"#ffffff",fontSize:"clamp(2rem, 8vw, 4rem)",fontWeight:"800",background:"linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",textShadow:"0 4px 20px rgba(255,255,255,0.3)",letterSpacing:"-0.02em",padding:"5px",margin:"0"},uploadSection:{textAlign:"center",marginBottom:"20px",position:"relative",padding:"0 10px"},customUploadContainer:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"19%",flexDirection:"column",gap:"20px",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",padding:"20px 20px",borderRadius:"24px",marginBottom:"0px",color:"#fff",cursor:"pointer",maxWidth:"910px",width:"100%",transition:"all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",position:"relative",overflow:"hidden",border:"2px solid rgba(255, 255, 255, 0.1)"},mainUploadButton:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:"16px 24px",background:"linear-gradient(135deg, #e9e9e9 0%, #e2d4e9 50%, #efefef 100%)",color:"black",border:"none",borderRadius:"50px",fontSize:"clamp(14px, 3vw, 16px)",fontWeight:"600",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",minWidth:"220px",margin:"0 auto",boxShadow:"0 10px 30px rgba(102, 126, 234, 0.4)",position:"relative",overflow:"hidden",width:"100%",maxWidth:"300px","&:hover":{transform:"translateY(-2px)",boxShadow:"0 15px 40px rgba(102, 126, 234, 0.6)"},"&:active":{transform:"translateY(0)"}},quickText:{fontWeight:"700",fontSize:"clamp(1rem, 4vw, 1.2em)",background:"linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},modalOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,animation:"modalFadeIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",padding:"20px"},modalContent:{background:"linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:"24px",width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.25)",animation:"modalSlideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},modalHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid rgba(0, 0, 0, 0.1)",background:"rgba(255, 255, 255, 0.5)",position:"sticky",top:0},modalTitle:{margin:0,fontSize:"clamp(18px, 5vw, 22px)",fontWeight:"700",background:"linear-gradient(135deg, #2d3436 0%, #636e72 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},modalCloseButton:{background:"rgba(255, 255, 255, 0.8)",border:"none",fontSize:"20px",cursor:"pointer",color:"#636e72",padding:"0",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",transition:"all 0.3s ease",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)","&:hover":{background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",transform:"rotate(90deg)"}},modalBody:{padding:"20px"},modalSection:{marginBottom:"20px"},modalSectionLabel:{display:"block",marginBottom:"10px",fontSize:"clamp(14px, 3vw, 15px)",fontWeight:"600",color:"#2d3436",letterSpacing:"0.5px"},fileInput:{width:"100%",padding:"14px 16px",border:"2px solid rgba(102, 126, 234, 0.2)",borderRadius:"16px",fontSize:"clamp(14px, 3vw, 15px)",background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",transition:"all 0.3s ease","&:focus":{outline:"none",borderColor:"#667eea",boxShadow:"0 0 0 4px rgba(102, 126, 234, 0.1)"}},modalDivider:{textAlign:"center",margin:"25px 0",position:"relative","&:before":{content:'""',position:"absolute",top:"50%",left:0,right:0,height:"1px",background:"linear-gradient(90deg, transparent, rgba(0,0,0,0.1), transparent)"}},modalDividerText:{background:"rgba(255, 255, 255, 0.9)",padding:"0 15px",color:"#636e72",fontSize:"clamp(13px, 3vw, 14px)",fontWeight:"600",position:"relative",zIndex:1},promptInput:{width:"100%",padding:"14px 16px",border:"2px solid rgba(102, 126, 234, 0.2)",borderRadius:"16px",fontSize:"clamp(14px, 3vw, 15px)",marginBottom:"16px",boxSizing:"border-box",background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",transition:"all 0.3s ease","&:focus":{outline:"none",borderColor:"#667eea",boxShadow:"0 0 0 4px rgba(102, 126, 234, 0.1)"}},generateButton:{width:"100%",padding:"14px 20px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"16px",fontSize:"clamp(14px, 3vw, 16px)",fontWeight:"600",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:"0 10px 25px rgba(102, 126, 234, 0.3)",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-2px)",boxShadow:"0 15px 35px rgba(102, 126, 234, 0.4)"}},generateButtonDisabled:{background:"linear-gradient(135deg, #b2bec3 0%, #636e72 100%)",cursor:"not-allowed",transform:"none",boxShadow:"none"},popupOverlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,padding:"16px"},popupContent:{background:"linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:"24px",maxWidth:"800px",width:"100%",maxHeight:"90vh",overflow:"hidden",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.25)",animation:"popupSlideIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},popupHeader:{padding:"20px",borderBottom:"1px solid rgba(0, 0, 0, 0.1)",background:"rgba(255, 255, 255, 0.6)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",position:"sticky",top:0,zIndex:10,display:"flex",justifyContent:"space-between",alignItems:"center"},popupTitle:{fontSize:"clamp(1.4rem, 6vw, 1.8rem)",fontWeight:"800",background:"linear-gradient(135deg, #2d3436 0%, #636e72 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",margin:0,letterSpacing:"-0.02em"},closeButton:{background:"rgba(255, 255, 255, 0.8)",border:"none",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",fontSize:"16px",color:"#636e72","&:hover":{background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",transform:"rotate(90deg) scale(1.1)"}},popupBody:{maxHeight:"80vh",overflowY:"auto",padding:"16px"},popupImageSection:{padding:"20px",margin:"16px",background:"rgba(255, 255, 255, 0.6)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"20px",marginBottom:"24px",border:"2px solid rgba(102, 126, 234, 0.1)",textAlign:"center",maxHeight:"300px",position:"relative",overflow:"hidden"},popupImageTitle:{fontSize:"clamp(16px, 4vw, 20px)",fontWeight:"700",marginBottom:"12px",background:"linear-gradient(135deg, #2d3436 0%, #636e72 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},popupSelectedImage:{maxWidth:"100%",maxHeight:"200px",borderRadius:"16px",border:"3px solid rgba(255, 255, 255, 0.8)",boxShadow:"0 15px 35px rgba(0,0,0,0.15)",transition:"transform 0.3s ease","&:hover":{transform:"scale(1.02)"}},selectedImageWrapper:{position:"relative",display:"inline-block"},resultsSection:{marginTop:"24px",borderTop:"2px solid rgba(102, 126, 234, 0.1)",paddingTop:"24px"},resultsTitle:{fontSize:"clamp(18px, 5vw, 24px)",fontWeight:"800",marginBottom:"20px",background:"linear-gradient(135deg, #2d3436 0%, #636e72 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",letterSpacing:"-0.01em"},loadingText:{textAlign:"center",fontSize:"clamp(16px, 4vw, 20px)",fontWeight:"600",background:"linear-gradient(135deg, #5DBDCA 0%, #7864AB 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",padding:"32px 0"},noProductsText:{textAlign:"center",fontSize:"clamp(15px, 4vw, 18px)",color:"#636e72",marginTop:"40px",fontWeight:"500"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(220px, 1fr))",gap:"16px",paddingBottom:"32px"},card:{borderRadius:"16px",background:"rgba(255, 255, 255, 0.96)",border:"1px solid rgba(231, 233, 255, 0.7)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxShadow:"0 10px 30px rgba(0,0,0,0.1)",overflow:"hidden",transition:"all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",border:"2px solid rgba(255, 255, 255, 0.3)",position:"relative","&:hover":{transform:"translateY(-8px) scale(1.02)",boxShadow:"0 25px 50px rgba(0,0,0,0.2)"}},cardImage:{width:"100%",height:"200px",objectFit:"cover",transition:"transform 0.4s ease"},cardTitle:{fontSize:"clamp(14px, 3vw, 16px)",fontWeight:"700",padding:"12px 16px 8px",color:"#2d3436",lineHeight:"1.4",letterSpacing:"-0.01em"},cardPrice:{fontSize:"clamp(16px, 4vw, 20px)",fontWeight:"800",background:"linear-gradient(135deg, #e17055 0%, #d63031 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",padding:"0 16px 8px"},cardOriginalPrice:{fontSize:"clamp(13px, 3vw, 15px)",color:"#b2bec3",textDecoration:"line-through",marginLeft:"6px",fontWeight:"500"},cardCategory:{fontSize:"clamp(12px, 3vw, 14px)",color:"#636e72",textTransform:"capitalize",padding:"0 16px 12px",fontWeight:"500",opacity:.8},viewDetailsButton:{margin:"0 16px 16px",padding:"10px 16px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#fff",border:"none",borderRadius:"12px",cursor:"pointer",fontWeight:"600",fontSize:"clamp(13px, 3vw, 15px)",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",boxShadow:"0 8px 20px rgba(102, 126, 234, 0.3)",position:"relative",overflow:"hidden","&:hover":{transform:"translateY(-2px)",boxShadow:"0 12px 30px rgba(102, 126, 234, 0.4)"}},mobileCard:{display:"flex",flexDirection:"row",alignItems:"flex-start",padding:"16px",background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"16px",marginBottom:"12px",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 25px rgba(0,0,0,0.1)",transition:"all 0.3s ease",width:"100%",position:"relative",overflow:"hidden"},mobileCardImage:{width:"100px",height:"100px",objectFit:"cover",borderRadius:"12px",marginRight:"12px",border:"2px solid rgba(255, 255, 255, 0.8)"},mobileCardContent:{flex:1,display:"flex",flexDirection:"column",justifyContent:"flex-start"},mobileCardTitle:{fontSize:"14px",fontWeight:"700",color:"#2d3436",marginBottom:"6px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.4"},mobileCardPrice:{fontSize:"15px",fontWeight:"800",background:"linear-gradient(135deg, #e17055 0%, #d63031 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",marginBottom:"10px"},mobileCardOriginalPrice:{fontSize:"12px",color:"#b2bec3",textDecoration:"line-through",marginLeft:"6px",fontWeight:"500"},mobileViewDetailsButton:{padding:"8px 12px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#fff",border:"none",borderRadius:"10px",cursor:"pointer",fontWeight:"600",fontSize:"12px",alignSelf:"flex-start",transition:"all 0.3s ease",boxShadow:"0 6px 15px rgba(102, 126, 234, 0.3)"},mobileProductsContainer:{display:"flex",flexDirection:"column",gap:"16px",paddingBottom:"32px"},aiProcessingOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%)",borderRadius:"16px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"white",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},aiIcon:{fontSize:"40px",marginBottom:"12px",animation:"aiPulse 2s infinite"},aiProcessingText:{fontSize:"clamp(16px, 4vw, 20px)",fontWeight:"700",marginBottom:"6px"},aiSubtext:{fontSize:"clamp(12px, 3vw, 14px)",opacity:.9,fontWeight:"500"},spinner:{display:"inline-block",width:"16px",height:"16px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite"},generatingContent:{display:"flex",alignItems:"center",gap:"8px"},imagePreview:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",marginBottom:"16px"},previewButtonGroup:{display:"flex",justifyContent:"center",gap:"12px",marginTop:"16px",flexWrap:"wrap"},previewButton:{padding:"8px 16px",borderRadius:"4px",border:"none",cursor:"pointer",fontSize:"14px",fontWeight:"bold",transition:"all 0.3s ease",minWidth:"120px"},"@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}},"@keyframes aiPulse":{"0%":{transform:"scale(1)",opacity:1},"50%":{transform:"scale(1.1)",opacity:.8},"100%":{transform:"scale(1)",opacity:1}},"@keyframes modalFadeIn":{"0%":{opacity:0},"100%":{opacity:1}},"@keyframes modalSlideUp":{"0%":{opacity:0,transform:"translateY(30px) scale(0.95)"},"100%":{opacity:1,transform:"translateY(0) scale(1)"}},"@keyframes popupSlideIn":{"0%":{opacity:0,transform:"translateY(40px) scale(0.9)"},"100%":{opacity:1,transform:"translateY(0) scale(1)"}},"@media (min-width: 768px)":{container:{padding:"0 24px"},title:{padding:"60px 0 30px"},customUploadContainer:{padding:"40px"},modalContent:{width:"90%"},modalHeader:{padding:"25px 30px"},modalBody:{padding:"30px"},popupHeader:{padding:"25px 30px"},popupBody:{padding:"30px"},popupImageSection:{padding:"30px",margin:"20px 60px"},cardImage:{height:"220px"},mobileCardImage:{width:"120px",height:"120px"}},"@media (min-width: 1024px)":{container:{maxWidth:"1200px",margin:"0 auto"},grid:{gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"24px"},cardImage:{height:"240px"}}};function c({props:e}){const t=(0,p.useFPI)();console.log(t,"FPI");const a=e.application_id.value,r=e.company_id.value,[n,i]=(0,l.useState)([]),[o,c]=(0,l.useState)(!1),[g,m]=(0,l.useState)(null),[u,x]=(0,l.useState)(!1),[b,f]=(0,l.useState)(!1),[y,h]=(0,l.useState)(!1),[v,k]=(0,l.useState)(!1),[w,C]=(0,l.useState)(!1),[S,E]=(0,l.useState)(""),[I,B]=(0,l.useState)(!1),[z,W]=(0,l.useState)(null),[F,P]=(0,l.useState)(null),T="/ext/abc/api/proxy/scan",A=e?.title?.value??"Snap & Shop - Find Products by Image",R=(0,l.useRef)(null);(0,l.useEffect)((()=>{y&&R.current&&R.current.focus()}),[y]),(0,l.useEffect)((()=>(document.body.style.overflow=u||y?"hidden":"",()=>{document.body.style.overflow=""})),[u,y]),(0,l.useEffect)((()=>{const e=()=>{const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768;f(e)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const D=e=>{const t=`/product/${e.slug||e.id||e.name.toLowerCase().replace(/\s+/g,"-")}`;window.open(t,"_blank")},j=e=>{P((t=>t===e?null:e))},H=()=>{x(!1),m(null),P(null)},_=e=>`₹${e.toLocaleString()}`,$=e=>e?e.replace(/-/g," ").replace(/\b\w/g,(e=>e.toUpperCase())):"",M=()=>{h(!1),E("")},L=()=>d().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",width:24,height:24},d().createElement("path",{d:"M4 7h2.586A2 2 0 0 0 8.414 6l.172-.172A2 2 0 0 1 10 5h4a2 2 0 0 1 1.414.586l.172.172A2 2 0 0 0 17.414 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2z"}),d().createElement("circle",{cx:"12",cy:"13",r:"3"})),O=()=>d().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},d().createElement("path",{d:"M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"})),U=()=>d().createElement("div",{style:s.aiProcessingOverlay},d().createElement("div",{style:{...s.aiIcon}},d().createElement("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d().createElement("path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"}),d().createElement("path",{d:"M12 12v9"}),d().createElement("path",{d:"m8 17 4 4 4-4"}))),d().createElement("div",{style:s.aiProcessingText},"AI Processing"),d().createElement("div",{style:s.aiSubtext},"Analyzing image patterns"),d().createElement("div",{style:{marginTop:"15px",display:"flex"}},d().createElement("div",{style:{...s.dotsAnimation,...s.dotsAnimation1}}),d().createElement("div",{style:{...s.dotsAnimation,...s.dotsAnimation2}}),d().createElement("div",{style:{...s.dotsAnimation,...s.dotsAnimation3}}))),G=({product:e,isActive:a,onClose:r})=>{const[n,i]=(0,l.useState)(""),[o,p]=(0,l.useState)(""),[s,c]=(0,l.useState)(!1),[g,m]=(0,l.useState)(null),u={container:{position:"absolute",top:0,right:0,width:"100%",height:"100%",backgroundColor:"rgba(252, 252, 252, 0.97)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",zIndex:2,transform:"translateX(100%)",transition:"transform 0.75s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",flexDirection:"column",boxSizing:"border-box",overflowY:"auto",boxShadow:"-5px 0px 20px rgba(0,0,0,0.1)"},containerActive:{transform:"translateX(0)"},contentWrapper:{padding:"20px"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",borderBottom:"1px solid #e0e0e0",paddingBottom:"10px"},title:{fontSize:"16px",fontWeight:"bold",color:"#333",margin:0},closeButton:{background:"transparent",border:"none",fontSize:"24px",cursor:"pointer",padding:"0 5px",lineHeight:1,color:"#555"},label:{display:"block",marginBottom:"8px",fontWeight:"600",fontSize:"14px",color:"#333"},sizeContainer:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"20px"},sizeButton:{padding:"8px 12px",border:"1px solid #ddd",backgroundColor:"#fff",borderRadius:"4px",cursor:"pointer",minWidth:"45px",textAlign:"center",fontSize:"13px",transition:"all 0.2s ease"},sizeButtonSelected:{borderColor:"#4CAF50",backgroundColor:"#e8f5e9",color:"#1e4620",fontWeight:"bold"},pincodeInput:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",boxSizing:"border-box",marginBottom:"20px"},submitButton:{width:"100%",padding:"12px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",fontSize:"15px",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},submitButtonDisabled:{backgroundColor:"#aaa",cursor:"not-allowed"}};return d().createElement("div",{style:{...u.container,...a?u.containerActive:{}}},d().createElement("div",{style:u.contentWrapper},d().createElement("div",{style:u.header},d().createElement("h3",{style:u.title},"Add to Cart"),d().createElement("button",{onClick:r,style:u.closeButton},"×")),e.sizes&&e.sizes.length>0&&d().createElement("div",{style:{marginBottom:"15px"}},d().createElement("label",{style:u.label},"Select Size"),d().createElement("div",{style:u.sizeContainer},e.sizes.map(((e,t)=>d().createElement("button",{key:t,style:{...u.sizeButton,...n===e.size?u.sizeButtonSelected:{}},onClick:()=>i(e.size)},e.size))))),d().createElement("div",null,d().createElement("label",{style:u.label},"Enter Pincode"),d().createElement("input",{type:"text",value:o,onChange:e=>{const t=e.target.value.replace(/\D/g,"");t.length<=6&&p(t)},placeholder:"6-digit pincode",style:u.pincodeInput})),d().createElement("button",{style:{...u.submitButton,...s?u.submitButtonDisabled:{}},onClick:async()=>{if(n)if(o&&6===o.length)try{c(!0);const a=await t.executeGQL("\n query locality($locality: LocalityEnum!, $localityValue: String!, $country: String) {\n locality(locality: $locality, localityValue: $localityValue, country: $country) {\n display_name\n id\n name\n parent_ids\n type\n localities {\n id\n name\n display_name\n parent_ids\n type\n }\n }\n }\n ",{locality:"pincode",localityValue:o,country:"IN"});if(!a?.data?.locality&&!a?.locality)return alert("Invalid pincode or locality service unavailable"),void c(!1);const i=await t.executeGQL("\n query ProductPrice($slug: String!, $size: String!, $pincode: String!) {\n productPrice(slug: $slug, size: $size, pincode: $pincode) {\n article_id\n discount\n is_cod\n is_gift\n item_type\n long_lat\n pincode\n quantity\n seller_count\n special_badge\n price_per_piece {\n currency_code\n currency_symbol\n effective\n marked\n selling\n }\n seller {\n count\n name\n uid\n }\n store {\n uid\n name\n count\n }\n }\n }\n ",{slug:e.slug,size:n,pincode:o}),l=i?.data?.productPrice||i?.productPrice;if(!l)return alert("Product not available for this pincode and size combination"),void c(!1);m(l),await(async a=>{try{const i=await t.executeGQL("\n mutation AddItemsToCart($buyNow: Boolean, $areaCode: String!, $addCartRequestInput: AddCartRequestInput) {\n addItemsToCart(buyNow: $buyNow, areaCode: $areaCode, addCartRequestInput: $addCartRequestInput) {\n message\n partial\n success\n cart {\n id\n is_valid\n items {\n article {\n identifier\n size\n seller {\n name\n uid\n }\n price {\n base {\n currency_code\n currency_symbol\n effective\n marked\n }\n }\n }\n product {\n name\n slug\n brand {\n name\n }\n }\n }\n }\n }\n }\n ",{buyNow:!1,areaCode:o,addCartRequestInput:{items:[{article_id:a.article_id,item_id:e.uid||parseInt(e.slug.split("-").pop()),item_size:n,quantity:1,seller_id:a.seller.uid,store_id:a.store.uid}]}}),l=i?.data?.addItemsToCart||i?.addItemsToCart;l?.success?(alert("Product added to cart successfully!"),r()):alert(`Failed to add product to cart: ${l?.message||"Unknown error"}`)}catch(e){console.error("Add to cart failed:",e),alert(`Failed to add product to cart: ${e.message}`)}finally{c(!1)}})(l)}catch(e){console.error("Serviceability check failed:",e),alert(`Failed to check serviceability: ${e.message}`),c(!1)}else alert("Please enter a valid 6-digit pincode");else alert("Please select a size")},disabled:s},s?"Adding...":d().createElement(d().Fragment,null,d().createElement(O,null)," Confirm & Add"))))};return d().createElement("div",{style:s.container},d().createElement("div",null,d().createElement("title",null,A)),d().createElement("h1",{style:s.title},A),d().createElement("div",{style:s.uploadSection},d().createElement("div",{style:s.customUploadContainer},d().createElement("div",{style:{display:"flex",alignItems:"center",gap:"20px",flexDirection:b?"column":"row",textAlign:b?"center":"left"}},d().createElement("button",{onClick:()=>{h(!0)},style:{...s.mainUploadButton,margin:0,backgroundColor:"white",color:"black",border:"2px solid #7fd7f7",width:b?"100%":"auto"},disabled:o},o?d().createElement(d().Fragment,null,d().createElement("span",{style:s.spinner}),"Analyzing Image..."):d().createElement(d().Fragment,null,d().createElement(L,null),"Upload Product Image")),d().createElement("div",{style:{color:"#fff",marginTop:b?"6px":0}},d().createElement("span",{style:s.quickText},"iSnapToShop")," – Upload or generate images to find your perfect product match.")))),y&&d().createElement("div",{style:s.modalOverlay},d().createElement("div",{style:s.modalContent},d().createElement("div",{style:s.modalHeader},d().createElement("h2",{style:s.modalTitle},"Upload Product Image"),d().createElement("button",{style:s.modalCloseButton,onClick:M},"×")),d().createElement("div",{style:s.modalBody},d().createElement("div",{style:s.modalSection},d().createElement("label",{style:s.modalSectionLabel},"Upload Image"),d().createElement("input",{type:"file",onChange:e=>{const t=e.target.files&&e.target.files[0];t&&(async e=>{if(e)if(e.type.startsWith("image/"))try{m(URL.createObjectURL(e)),c(!0),h(!1);const t=new FormData;t.append("image",e),t.append("company_id",r);const n=await fetch(`${T}/search-by-image-using-store-front?application_id=${a}&company_id=${r}`,{method:"POST",body:t,credentials:"include"}),o=await n.json();i(o.results||[]),o.results&&o.results.length>0&&x(!0)}catch(e){console.error("Error during image upload search:",e),i([]),alert("Error processing image. Please try again.")}finally{c(!1)}else alert("Please select a valid image file")})(t)},accept:"image/*",style:s.fileInput})),d().createElement("div",{style:s.modalDivider},d().createElement("span",{style:s.modalDividerText},"OR")),d().createElement("div",{style:s.modalSection},d().createElement("button",{onClick:()=>{M(),k(!0)},style:s.generateButton},"Generate Image via Prompt"))))),v&&d().createElement("div",{style:s.modalOverlay},d().createElement("div",{style:s.modalContent},d().createElement("div",{style:s.modalHeader},d().createElement("h2",{style:s.modalTitle},"Generate Product Image"),d().createElement("button",{style:s.modalCloseButton,onClick:()=>{k(!1),E("")}},"×")),d().createElement("div",{style:s.modalBody},d().createElement("div",{style:s.modalSection},d().createElement("label",{style:s.modalSectionLabel},"Describe your product"),d().createElement("input",{type:"text",ref:R,style:s.promptInput,placeholder:'Describe your product (e.g., "White jordan sneakers")',value:S,onChange:e=>E(e.target.value),disabled:I}),d().createElement("button",{onClick:()=>async function(e){if(e.trim())try{B(!0);const t=await fetch(`${T}/generate-prompts-to-image?company_id=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e}),credentials:"include"}),a=await t.json();if(!a.success||!a.imageUrl)throw new Error(a.message||"Image generation failed");W(a.imageUrl),C(!0),E("")}catch(e){console.error("Error generating/searching image:",e),alert("Failed to generate or search image. Please try again."),B(!1)}finally{B(!1)}else alert("Please enter a description for the image")}(S),style:{...s.generateButton,...I||!S?s.generateButtonDisabled:{}},disabled:I||!S},I?d().createElement("div",{style:s.generatingContent},d().createElement("span",{style:s.spinner}),d().createElement("span",null,"Generating...")):"Generate Image"),d().createElement("div",{style:{marginTop:"5px"}},d().createElement("button",{onClick:()=>{h(!0),k(!1)},style:s.generateButton},"Upload Image")))))),w&&z&&d().createElement("div",{style:s.modalOverlay},d().createElement("div",{style:{...s.modalContent,maxWidth:"40%",maxHeight:"90vh",overflowY:"auto",display:"flex",flexDirection:"column"}},d().createElement("div",{style:s.modalHeader},d().createElement("h2",{style:s.modalTitle},"Preview Generated Image"),d().createElement("button",{style:s.modalCloseButton,onClick:()=>C(!1)},"×")),d().createElement("div",{style:{...s.modalBody,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between"}},d().createElement("div",{style:{marginBottom:"20px",flex:1}},d().createElement("img",{src:z,alt:"Generated from prompt",style:{maxWidth:"100%",maxHeight:"27vh",borderRadius:"8px",objectFit:"contain"}})),d().createElement("div",{style:{display:"flex",justifyContent:"center",gap:"15px",padding:"20px 0",flexWrap:"wrap"}},d().createElement("button",{onClick:()=>(E(S),C(!1),void h(!0)),style:{...s.generateButton,backgroundColor:"#f0f0f0",color:"white",border:"1px solid #ccc",minWidth:"150px",margin:"5px"}},"Regenerate"),d().createElement("button",{onClick:async()=>{if(z){console.log(z,"1111111111");try{c(!0),C(!1),await(async e=>{try{c(!0),h(!1);const t=await fetch(e,{method:"GET",headers:{Accept:"image/*"},mode:"cors"});if(!t.ok)throw new Error(`Failed to fetch image: ${t.status}`);const n=await t.blob();let o=n.type;o&&o.startsWith("image/")||(o="image/png"),console.log("Blob details:",{type:n.type,size:n.size,finalMimeType:o});const l=new FormData,d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(/Android [1-4]\./.test(navigator.userAgent)){console.log("Detected old Android, using special handling");const e=await n.arrayBuffer(),t=new Blob([e],{type:o});l.append("image",t,"generated-image.png")}else if(d)try{const e=new File([n],"generated-image.png",{type:o,lastModified:Date.now()});l.append("image",e)}catch(e){console.log("File constructor failed on mobile, using blob"),l.append("image",n,"generated-image.png")}else{const e=new File([n],"generated-image.png",{type:o,lastModified:Date.now()});l.append("image",e)}l.append("company_id",r),console.log("FormData entries:");for(let e of l.entries())console.log(e[0],e[1]);m(e);const p=await fetch(`${T}/search-by-image-using-store-front?application_id=${a}&company_id=${r}`,{method:"POST",body:l,credentials:"include"});if(!p.ok)throw new Error(`Upload failed: ${p.status} ${p.statusText}`);const s=await p.json();i(s.results||[]),s.results&&s.results.length>0&&x(!0)}catch(e){console.error("Enhanced upload failed:",e),i([]),alert(`Error processing image: ${e.message}`)}finally{c(!1)}})(z)}catch(e){console.error("Error processing generated image:",e),alert("Error processing image. Please try again.")}finally{c(!1)}}},style:{...s.generateButton,backgroundColor:"#4CAF50",minWidth:"150px",margin:"5px"}},"Use This Image"))))),(u||o)&&d().createElement("div",{style:s.popupOverlay,onClick:H},d().createElement("div",{style:s.popupContent,onClick:e=>e.stopPropagation()},d().createElement("div",{style:s.popupHeader},d().createElement("h2",{style:s.popupTitle},n.length>0?`Search Results (${n.length} products)`:"Searching for products"),d().createElement("button",{style:s.closeButton,onClick:H},"×")),d().createElement("div",{style:s.popupBody},g&&d().createElement("div",{style:s.popupImageSection},d().createElement("div",{style:s.popupImageTitle},"Your Uploaded Image"),d().createElement("div",{style:s.selectedImageWrapper},d().createElement("img",{src:g,alt:"Uploaded for search",style:s.popupSelectedImage}),o&&d().createElement(U,null))),o?d().createElement("p",{style:s.loadingText},"Finding perfect matches for you..."):d().createElement(d().Fragment,null,n.length>0&&d().createElement("div",{style:s.resultsSection},d().createElement("div",{style:s.resultsTitle},"Matching Products"),b?d().createElement("div",{style:s.mobileProductsContainer},n.map(((e,t)=>{const a=e.slug||`mobile-product-${t}`;return d().createElement("div",{key:a,style:s.mobileCard},d().createElement("div",{style:{display:"flex",flexDirection:"row",width:"100%",pointerEvents:F===a?"none":"auto"}},d().createElement("img",{src:e.image,alt:e.name,style:s.mobileCardImage,onError:e=>{e.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIiBmaWxsPSIjOTk5Ij5ObyBJbWFnZTwvdGV4dD48L3N2Zz4="}}),d().createElement("div",{style:s.mobileCardContent},d().createElement("h3",{style:s.mobileCardTitle},e.name),e.category&&d().createElement("p",{style:s.cardCategory},$(e.category)),e.sizes&&e.sizes.length>0&&d().createElement("div",{style:s.mobileCardPrice},_(e.sizes[0].price.effective.min),e.sizes[0].price.marked.min>e.sizes[0].price.effective.min&&d().createElement("span",{style:s.mobileCardOriginalPrice},_(e.sizes[0].price.marked.min))),d().createElement("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"10px",flexWrap:"nowrap",alignItems:"flex-start"}},d().createElement("button",{style:{padding:"6px 14px",fontSize:"13px",borderRadius:"4px",border:"none",backgroundColor:"#007BFF",color:"#fff",cursor:"pointer",width:"130px"},onClick:()=>D(e)},"View Details"),d().createElement("button",{style:{padding:"6px 14px",fontSize:"13px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"5px",width:"130px"},onClick:()=>j(a)},d().createElement(O,null)," Add to Cart")))),d().createElement(G,{key:a,product:e,isActive:F===a,onClose:()=>P(null)}))}))):d().createElement("div",{style:s.grid},n.map(((e,t)=>{const a=e.slug||`desktop-product-${t}`;return d().createElement("div",{key:a,style:s.card},d().createElement("img",{src:e.image,alt:e.name,style:s.cardImage,onError:e=>{e.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIiBmaWxsPSIjOTk5Ij5ObyBJbWFnZTwvdGV4dD48L3N2Zz4="}}),d().createElement("h3",{style:s.cardTitle},e.name.length>16?e.name.slice(0,16)+"...":e.name),e.category&&d().createElement("p",{style:s.cardCategory},$(e.category)),e.sizes&&e.sizes.length>0&&d().createElement("div",{style:s.cardPrice},_(e.sizes[0].price.effective.min),e.sizes[0].price.marked.min>e.sizes[0].price.effective.min&&d().createElement("span",{style:s.cardOriginalPrice},_(e.sizes[0].price.marked.min))),d().createElement("div",{style:{display:"flex",flexWrap:"nowrap",gap:"8px",marginTop:"4px",marginLeft:"20px",marginBottom:"10px"}},d().createElement("button",{style:{padding:"4px 10px",fontSize:"12px",borderRadius:"4px",border:"none",backgroundColor:"#007BFF",color:"#fff",cursor:"pointer",whiteSpace:"nowrap"},onClick:()=>D(e)},"View Details"),d().createElement("button",{style:{padding:"4px 10px",fontSize:"12px",borderRadius:"4px",border:"none",backgroundColor:"#4CAF50",color:"#fff",cursor:"pointer",display:"flex",alignItems:"center",gap:"5px",whiteSpace:"nowrap"},onClick:()=>j(a)},d().createElement(O,{style:{fontSize:"14px"}})," Add to Cart")),d().createElement(G,{key:a,product:e,isActive:F===a,onClose:()=>P(null)}))})))),0===n.length&&!o&&d().createElement("p",{style:s.noProductsText},"No matching products found."))))))}c.serverFetch=async({fpi:e})=>({});const g={label:"iSnapToShop",name:"product-list",props:[{id:"title",label:"Page Title",type:"text",default:"",info:"Page Title"},{id:"company_id",label:"Company ID",type:"text",default:"",info:"Company ID",require:!0},{id:"application_id",label:"Application ID",type:"text",default:"",info:"Application ID",require:!0}],blocks:[]},m={"product-list":{...o}};return i})()));